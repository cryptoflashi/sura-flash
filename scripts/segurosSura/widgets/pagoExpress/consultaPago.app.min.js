appPagoExpress.controller("searchController", function($rootScope, $location, $scope, $window, pagoExpressService) {
    window.location.replace('https://www.segurossura.com.co/paginas/pago-express.aspx#/Pagos');
    $scope.$on('$locationChangeStart', function(event, next, current) { event.preventDefault(); });
    pagoExpressService.showPayPendingReceipts = true;
    $scope.ltDocumentsType = ltDocumentsType;
    $scope.query = { incomeType: "DOCUMENT", documentType: "13", document: "", invoice: "" };
    $scope.validations = { documentType: { required: true, }, document: { required: true, }, invoice: { required: true, } };
    $scope.isNumeric = function(event) { if ($scope.query.documentType == '41') { return; } if (!numeric(event)) { event.preventDefault(); } };
    $scope.clean = function(type) {
        $scope.query.incomeType = type;
        console.log($scope.query.incomeType);
        if ($scope.query.incomeType == "DOCUMENT") { delete $scope.query.invoice; } else {
            $scope.query.documentType = "13";
            delete $scope.query.document;
        }
    }
    $scope.goToAssist = function() { window.location.href = urlAsisst; }
    $scope.search = function(recaptchaToken) {
        pagoExpressService.token = recaptchaToken;
        $scope.showLoader(true);
        pagoExpressService.searchPortfolio($scope.query).then(function(result) {
            if (!nullObjectValidate(result)) {
                token = result.token;
                pagoExpressService.information = result;
                if (!nullObjectValidate(result.customer.listAccountsReceivable)) { $scope.changeProgress(2); } else {
                    $scope.showLoader(false);
                    grecaptcha.reset(captcha);
                    gtag('config', 'UA-92878313-1', { page_tittle: 'no_pagos_pendientes', page_location: window.location.href.toLowerCase() + '#no_pagos_pendientes', page_path: window.location.pathname.toLowerCase() + '#no_pagos_pendientes' });
                    var content = document.createElement("span");
                    content.appendChild(document.createTextNode("Actualmente no tienes recibos pendientes. Verifica la cédula que ingresaste para mayor seguridad."));
                    content.appendChild(document.createElement("br"));
                    content.appendChild(document.createElement("br"));
                    content.appendChild(document.createTextNode("Si deseas ver los pagos que has realizado, da clic en Ver historial."));
                    swal({ html: true, content: content, icon: "info", buttons: { history: { text: "Ver historial", value: "history", className: "swal-button--cancel" }, accept: { text: "¡Entendido!", value: false } } }).then(function(answer) {
                        if (answer == "history") {
                            pagoExpressService.showPayPendingReceipts = false;
                            $scope.changeProgress('history');
                            $scope.$apply();
                        }
                    });
                }
            } else {
                $scope.showLoader(false);
                grecaptcha.reset(captcha);
                swal({ text: "No se encontró el número de recibo.", icon: "info", buttons: { accept: { text: "Aceptar" } } });
            }
        }, function(error) {
            var msnError = "No se pudo realizar la consulta de los recibos, Intente de nuevo mas tarde!";
            grecaptcha.reset(captcha);
            if (error.errors[0].reason.indexOf("Captcha") > 0) { msnError = error.errors[0].reason; }
            console.log(error);
            swal({ title: "Fallo Servicio de Pago", text: msnError, icon: "error", buttons: { accept: { text: "Aceptar" } } });
            $scope.showLoader(false);
        })['finally'](function() { goToTop("s4-workspace"); });
    };
    $window.search = $scope.search;
    $window.onLoadCaptcha = function() {
        grecaptcha.render('searchPayment', { 'sitekey': recapchaKey, 'callback': search });
        document.getElementById("searchPayment").disabled = true;
    }
    $scope.showLoader(false);
});